<!DOCTYPE html>
<html>

<head>
    <title>Loading</title>
    <link href='https://fonts.googleapis.com/css?family=Roboto:100,400,300,500,700' rel='stylesheet' type='text/css'>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<style>
    .fond {
        position: absolute;
        padding-top: 335px;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("static/img/binoculars.jpg") no-repeat center center fixed;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
    }

    .contener_ball {
        height: 115px;
        width: 90px;
        overflow: hidden;
    }

    .ball_bleu {
        border-radius: 30px;
        width: 30px;
        -webkit-animation: anim 1s infinite ease;
        -moz-animation: anim 1s infinite ease;
        -ms-animation: anim 1s infinite ease;
        -o-animation: anim 1s infinite ease;
        animation: anim 1s infinite ease;
    }

    .ombre_bleu {
        border-radius: 30px;
        display: inline-block;
        background-color: rgba(153, 153, 153, 0.2);
        box-shadow: 1px 1px 8px #999999;
        -webkit-animation: anim_ombre 1s infinite ease;
        -moz-animation: anim_ombre 1s infinite ease;
        -ms-animation: anim_ombre 1s infinite ease;
        -o-animation: anim_ombre 1s infinite ease;
        animation: anim_ombre 1s infinite ease;
    }

    @-webkit-keyframes anim {
        0% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
        25% {
            height: 15px;
            margin-top: 100px;
            background-color: #746823;
        }
        100% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
    }

    @-webkit-keyframes anim_ombre {
        0% {
            width: 90px;
            height: 2px;
        }
        25% {
            width: 30px;
            height: 2px;
        }
        100% {
            width: 90px;
            height: 2px;
        }
    }

    @-moz-keyframes anim {
        0% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
        25% {
            height: 15px;
            margin-top: 100px;
            background-color: #746823;
        }
        100% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
    }

    @-moz-keyframes anim_ombre {
        0% {
            width: 90px;
            height: 2px;
        }
        25% {
            width: 30px;
            height: 2px;
        }
        100% {
            width: 90px;
            height: 2px;
        }
    }

    @-ms-keyframes anim {
        0% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
        25% {
            height: 15px;
            margin-top: 100px;
            background-color: #746823;
        }
        100% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
    }

    @-ms-keyframes anim_ombre {
        0% {
            width: 90px;
            height: 2px;
        }
        25% {
            width: 30px;
            height: 2px;
        }
        100% {
            width: 90px;
            height: 2px;
        }
    }

    @keyframes anim {
        0% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
        25% {
            height: 15px;
            margin-top: 100px;
            background-color: #746823;
        }
        100% {
            height: 30px;
            margin-top: 0px;
            background-color: #529869;
        }
    }

    @keyframes anim_ombre {
        0% {
            width: 90px;
            height: 2px;
        }
        25% {
            width: 30px;
            height: 2px
        }
        100% {
            width: 90px;
            height: 2px;
        }
    }

</style>

<body>
    <div align="center" class="fond">
        <div align="center">
            <div class="contener_ball">
                <div class="ball_bleu"></div>
            </div>
        </div>
    </div>
    <div id="plotly"></div>
</body>
<script>
    $(document).ready(function() {
        myPlot = document.getElementById('plotly');
        var myData = [{
                x: [],
                y: [],
                name: 'Nudity'
            },
            {
                x: [],
                y: [],
                name: 'Violence'
            },
            {
                x: [],
                y: [],
                name: 'Drugs'
            },
            {
                x: [],
                y: [],
                name: 'Alcohol'
            },
            {
                x: [],
                y: [],
                name: 'Overall Safeness'
            }
        ];
        var layout = {
            title: 'Title of the Graph',
            hovermode: 'closest',
            xaxis: {
                title: 'Time',
                autotick: false,
                tick0: 0,
                dtick: 1
            },
            yaxis: {
                title: 'Value',
                dtick: 0.1,
                autotick: false,
                range: [0, 1],
                autorange: false
            }
        };
        var x = []
        
        // start up the SocketIO connection to the server - the namespace 'test' is also included here if necessary
        var url_split = window.location.href.split('/');
        console.log(url_split[url_split.length - 1]);
        var socket = io.connect('http://' + document.domain + ':' + location.port + '/' + url_split[url_split.length - 1]);
        console.log(socket);
        // this is a callback that triggers when the "my response" event is emitted by the server.
        socket.on('my response', function(msg) {
            //                $('#log').append('<p>Received: ' + msg.data + '</p>');
            console.log('Received' + JSON.stringify(msg));
            msg.data.frames.forEach((element, index) => {
                x.push(index);
                myData[0].y.push(element.nudity.raw);
                myData[1].y.push(element.weapon);
                myData[2].y.push(element.drugs);
                myData[3].y.push(element.alcohol);
                myData[4].y.push(element.nudity.safe);
            });
            console.log('data: ' + JSON.stringify(myData[0]));
            myData.forEach(element => {
                element.x = x;
            });
            console.log('updated data' + JSON.stringify(myData[0]));
            Plotly.newPlot(myPlot, myData, layout);
        });
    })
</script>
</html>
